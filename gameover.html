<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="render.css">
    <title>ISAT Game Over Gif Maker | In Stars And Time Game Over Gif Maker</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://cdn.jsdelivr.net/npm/gif.js/dist/gif.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gif.js/dist/gif.worker.js"></script>
    <link rel="preload" href="./assets/VCR_OSD_MONO.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="./assets/OpenDyslexic3-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="./assets/OpenDyslexic3-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">
</head>
<body>
    <div style="display: flex; justify-content: center; align-items: center; flex-direction: column; text-align: center; margin-top: 20px;">
        <div style="margin-top: 10px; border-radius: 100px; width: 100px; height: 100px; background-image: url('./assets/profilePic.png'); background-repeat: no-repeat; background-position: center center; background-size: cover;"></div>
        <p style="font-size: 1.7rem; font-weight: bold;">In Stars And Time Dialogue Maker</p>
        <p style="font-size: 1.3rem;">Made by kongkrog(lea)</p>
        <p style="font-size: 1.3rem;">All assets belong to insertdisc5</p>
        <p style="font-size: 1rem;"><i>This webpage is currently avaliable on mobile.</i></p>
    </div>
    <h6 style="padding-top: 10px;"><span>CHANGE FONT</span></h6>
    <div id="buttonList" style="padding: 10px 0; gap: 10px;">
        <button id="dialogueButton" class="uiButton" style="font-family: VCR_OSD_MONO; width: auto;" onclick="changeFont('VCR_OSD_MONO')">
            <img id="cornerUpLeft" src="./assets/cursorBorderA.png">
            <img id="cornerDownRight" src="./assets/cursorBorderA.png">
            <img id="cornerUpRight" src="./assets/cursorBorderB.png">
            <img id="cornerDownLeft" src="./assets/cursorBorderB.png">
            Default
        </button>
        <button id="gameOverButton" class="uiButton" style="font-family: sans-serif, Helvetica, Arial; width: auto;" onclick="changeFont('Arial')">
            <img id="cornerUpLeft" src="./assets/cursorBorderA.png">
            <img id="cornerDownRight" src="./assets/cursorBorderA.png">
            <img id="cornerUpRight" src="./assets/cursorBorderB.png">
            <img id="cornerDownLeft" src="./assets/cursorBorderB.png">
            Arial
        </button>
        <button id="aboutMeButton" class="uiButton" style="font-family: OpenDyslexic3; font-size: 1.4rem; width: auto;" onclick="changeFont('OpenDyslexic3')">
            <img id="cornerUpLeft" src="./assets/cursorBorderA.png">
            <img id="cornerDownRight" src="./assets/cursorBorderA.png">
            <img id="cornerUpRight" src="./assets/cursorBorderB.png">
            <img id="cornerDownLeft" src="./assets/cursorBorderB.png">
            OpenDyslexic3
        </button>
    </div>
    <main id="dialogueMain" style="display: flex; justify-content: center; align-items: center; flex-direction: column; text-align: center;"> 
        <canvas id="gameOverCanvas" width="816" height="623" style="visibility: hidden; z-index: -1; position: fixed;"></canvas>
        <img src='assets/displayGameOver.gif' width="816" id="gifDisplay">
        <img src='' width="816" id="gifResult" style="display: none">
        <img src='' width="816" id="gifOptimize" style="display: none">
    </main>
    <p id="debug"></p>
    <a id="downloadLink" href = "">
        <button id="downloadButton" class="uiButton" style="margin-top: 20px; width: 250px; display: none;">
            <img id="cornerUpLeft" src="./assets/cursorBorderA.png">
            <img id="cornerDownRight" src="./assets/cursorBorderA.png">
            <img id="cornerUpRight" src="./assets/cursorBorderB.png">
            <img id="cornerDownLeft" src="./assets/cursorBorderB.png">
            <img src="./assets/settingicon.png" style="display: none;"> Download GIF
        </button>
    </a>
    <div id="buttonList">
        <button class="uiButton" id="settingButton">
            <img id="cornerUpLeft" src="./assets/cursorBorderA.png">
            <img id="cornerDownRight" src="./assets/cursorBorderA.png">
            <img id="cornerUpRight" src="./assets/cursorBorderB.png">
            <img id="cornerDownLeft" src="./assets/cursorBorderB.png">
            <img src="./assets/settingicon.png"> Setting
        </button>
        <button class="uiButton" onclick="location.href='./render.html'">
            <img id="cornerUpLeft" src="./assets/cursorBorderA.png">
            <img id="cornerDownRight" src="./assets/cursorBorderA.png">
            <img id="cornerUpRight" src="./assets/cursorBorderB.png">
            <img id="cornerDownLeft" src="./assets/cursorBorderB.png">
            <img src="./assets/settingicon.png"> Homepage
        </button>
    </div>
    <p style="font-size: 1rem; text-align: center;"><strong>For those who want to change the game over animation.</strong><br> Download this <a href="https://github.com/kongkrog/isat-profile-customizer">repo</a> and replace the images in the "frames" folder.<br> You will need to host a local server and run the gameover.html file.</p> 
    <p style="font-size: 1rem; text-align: center;">Made using <a href="https://github.com/jnordberg/gif.js">gif.js</a> and <a href="https://github.com/renzhezhilu/gifsicle-wasm-browser">gifsicle (the browser version)</a>.</p>
    
    <form id="settingPanel" onsubmit="updateProfile()" style="gap: 10px; font-size: 1.3rem;">
        <h6><span>GAME OVER SETTING <button class="toggleButton" id="gameOverToggle" onclick="toggleVisibility('gameOverSetting', 'gameOverToggle')" type="button">[-]</button></span></h6>
        
        <div id="gameOverSetting">
            <div class="inputRow">
                <label for="deathMessage">Death Message:</label>
                <input style="width: 100px;" type="text" id="deathMessage" fname="deathMessage" style="flex-grow: 1;">
            </div>

            <div class="inputRow">
                <label for="textAfterLoop">After Loop Message:</label>
                <input style="width: 100px;" type="text" id="textAfterLoop" fname="textAfterLoop" style="flex-grow: 1;">
            </div>
            <p style="font-size: 1.2rem;">Leave this empty to skip the looping back part of the gif.</p>
            
            <div class="inputRow">
                <label for="cursorPosition">Cursor Position:</label>
                <select id="cursorPosition" fname="cursorPosition" default="left" style="flex-grow: 1;" value="left">
                    <option value="left">Left</option>
                    <option value="right">Right</option>
                    <option value="none">None</option>
                </select>
            </div>
            <p style="font-size: 1.2rem;">Select this to None to remove the cursor.</p>
        </div>

        <h6><span>LEFT TEXT <button class="toggleButton" id="leftToggle" onclick="toggleVisibility('leftSetting', 'leftToggle')" type="button">[-]</button></span></h6>

        <div id="leftSetting">
            <div class="inputRow">
                <label for="textAfterLoop">Left text 1:</label>
                <input style="width: 100px;" type="text" id="leftText1" fname="leftText1" style="flex-grow: 1;" value="START">
            </div>
            
            <div class="inputRow">
                <label for="textAfterLoop">Left text 2:</label>
                <input style="width: 100px;" type="text" id="leftText2" fname="leftText2" style="flex-grow: 1;" value="AGAIN">
            </div>
        </div>

        <h6><span>RIGHT TEXT <button class="toggleButton" id="rightToggle" onclick="toggleVisibility('rightSetting', 'rightToggle')" type="button">[-]</button></span></h6>

        <div id="rightSetting">
            <div class="inputRow">
                <label for="textAfterLoop">Right text 1:</label>
                <input style="width: 100px;" type="text" id="rightText1" fname="rightText1" style="flex-grow: 1;" value="QUIT">
            </div>
            
            <div class="inputRow">
                <label for="textAfterLoop">Right text 2:</label>
                <input style="width: 100px;" type="text" id="rightText2" fname="rightText2" style="flex-grow: 1;" value="">
            </div>
        </div>
        
        <h6><span>EFFECT OPTIONS <button class="toggleButton" id="effectToggle" onclick="toggleVisibility('effectSetting', 'effectToggle')" type="button">[-]</button></span></h6>

        <div id="effectSetting">
            <div class="inputRow">
                <label for="isNoise">Noise Effect?</label>
                <input style="width: 100px;" type="checkbox" id="isNoise" fname="isNoise" style="flex-grow: 1;">
            </div>
            <div class="inputRow">
                <label for="isVHS">VHS Effect?</label>
                <input style="width: 100px;" type="checkbox" id="isVHS" fname="isVHS" style="flex-grow: 1;">
            </div>
            <p style="font-size: 1.2rem;">Using effect will significantly increase gif file size.</p>
            <div class="inputRow">
                <label for="isSkipLoopBack">Skipping Looping Back Animation?</label>
                <input style="width: 100px;" type="checkbox" id="isSkipLoopBack" fname="isSkipLoopBack" style="flex-grow: 1;">
            </div>
        </div>

        <div class="inputRow">
            <button class="uiButton" type="button" id="saveButton" style="flex-grow: 1;">
                <img id="cornerUpLeft" src="./assets/cursorBorderA.png">
                <img id="cornerDownRight" src="./assets/cursorBorderA.png">
                <img id="cornerUpRight" src="./assets/cursorBorderB.png">
                <img id="cornerDownLeft" src="./assets/cursorBorderB.png">
                <img src="./assets/saveicon.png"> Save
            </button>
            <button class="uiButton" type="button" id="exitButton" style="flex-grow: 1;">
                <img id="cornerUpLeft" src="./assets/cursorBorderA.png">
                <img id="cornerDownRight" src="./assets/cursorBorderA.png">
                <img id="cornerUpRight" src="./assets/cursorBorderB.png">
                <img id="cornerDownLeft" src="./assets/cursorBorderB.png">
                <img src="./assets/quiticon.png"> Exit  
            </button>
        </div>
    </form>
    <script src="gameover.js"></script>
    <script type="module">
        import gifsicle from 'https://cdn.jsdelivr.net/npm/gifsicle-wasm-browser/dist/gifsicle.min.js';

        const debugText = document.getElementById('debug');
        const downloadButton = document.getElementById('downloadButton');
        const gifResult = document.getElementById('gifResult');
        var optimized_gif = ""

        function optimizeGIF(src, args) {
            gifsicle.run({
                input: [{
                    file: src,
                    name: "optimized.gif",
                }],
                command: [args]
            }).then(out => {
                console.log(out);
                out.map((f, indx) => {
                    optimized_gif = URL.createObjectURL(f);
                    document.getElementById('gifResult').src = optimized_gif;
                    gifResult.style.display = 'block';
                    downloadButton.style.display = 'inline-block';

                    downloadButton.addEventListener('click', function() {
                        const downloadLink = document.getElementById("downloadLink");
                        downloadLink.href = URL.createObjectURL(f);
                        downloadLink.download = 'animation.gif';
                    });
                debugText.innerText = "Finished optimizing."
                });
            });
        }

        var displayGif = document.getElementById('gifOptimize');
        var observer;

        observer = new MutationObserver((changes) => {
            changes.forEach(change => {
                if(change.attributeName.includes('src')){
                    optimizeGIF(displayGif.src, "-O1 --lossy=30 optimized.gif -o /out/out.gif");
                }
            });
        });
        
        observer.observe(displayGif, {attributes : true});
    </script>
</body>
</html>
